/*
 *  ======== package.bld ========
 */
Pkg.attrs.profile = "release";
Pkg.attrs.exportAll = true;
Pkg.uses = ["ti/msp432/runtime/wiring"];

var TARGET   = "ti.targets.arm.elf.M4F";
var PLATFORM = "ti.platforms.emt432";
var DEVICE   = "MSP432P401R";

var Platform = xdc.module(PLATFORM + ".Platform");
var DLIBROOT = Platform.findDriverLib();
print("  using DriverLib: " + DLIBROOT);

var CCOPTS = "--gcc --diag_warning=225";
CCOPTS = "";

var DEFS = "-D__MSP432P401R__=1";

var INCS = '-I"' + DLIBROOT + '" '
       + '-I"' + DLIBROOT + '/inc" '
       + '-I"' + DLIBROOT + '/inc/CMSIS" '
       + '-I"' + DLIBROOT + '/MSP432P4xx"';

var SRCS = getSources(".");

for (var i = 0; i < Build.targets.length; i++) {
    var targ = Build.targets[i];
    if (targ.$name == TARGET) {
        Pkg.addExecutable("energia", targ, PLATFORM + ":" + DEVICE + ":1", {
            incs: INCS,
            defs: DEFS,
            copts: CCOPTS
        }).addObjects(SRCS);
        break;
    }
    else {
	print("skipping " + targ.$name);
    }
}

function getSources(dir)
{
    var result = [];
    var list = java.io.File(dir).list();
    for (var i = 0; i < list.length; i++) {
        var file = String(list[i]);
        if (file.match(/\.c$|\.cpp$/) && file[0] != '.') {
            result.push(file);
        }
    }
    return (result);
}
